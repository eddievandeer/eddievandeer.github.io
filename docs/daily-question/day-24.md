---
title: Day-24 CDN如何实现加速
postTime: 2022-02-19
categories: 每日一题
tags: 
- 网络
- CDN
---

::: slot abstract

CDN 这个名词想必不会陌生，在很多地方都有听到过，以前我只是知道，它可以加快静态资源文件的获取速度，但它又是如何实现的？它的原理是什么呢？

想要写这一篇文章是因为，在刷面试题的时候看到了：如何加快页面的首页加载速度，其中就有 CDN 这么一个方式，可以加速资源获取，减少白屏时间。为了在面试的时候能够深入的聊聊 CDN ，于是决定好好学一下它的原理

:::



## CDN如何实现加速

### 什么是CDN

CDN 的全称是：Content Delivery Network ，翻译成中文为：**内容分发网络** ，这里引用一下 [知乎上别人的回答](https://www.zhihu.com/question/36514327)：

> CDN 是建立并覆盖在承载网之上，由分布在不同区域的边缘节点服务器群组成的分布式网络。
>
> CDN应用广泛，支持多种行业、多种场景内容加速，例如：图片小文件、大文件下载、视音频点播、直播流媒体、全站加速、安全加速。



### CDN的工作原理

首先我们先来看一下在没有使用 CDN 的情况下，传统的网络访问过程是什么样子的：

1. 获取要进行网络访问的域名
2. 浏览器向 Local DNS 域名解析服务器发送解析请求，获取域名对应的 IP 地址（省略了 LDNS 未命中的情况）
3. 浏览器向获取到的 IP 地址对应的服务器发送请求
4. 服务器响应该请求，返回响应数据

与上述的传统网络访问不同， CDN 网络下用户和服务器中间还有一个 **Cache 层** ，可以将用户的请求引导到 Cache 层节点进行数据访问，以此来减轻服务器源站点的压力，同时也可以通过调度，为请求分配最佳节点 IP 地址，减少请求的时间。网络访问的过程会变成这个样子：

1. 获取要进行网络访问的域名
1. 浏览器向 Local DNS 服务器发起解析请求，若不命中，该请求会被转发到授权DNS查询
1. 当授权 DNS 解析域名时，返回域名 CNAME 对应的 IP 地址
1. LDNS 获取到 CNAME 对应的 IP 地址后向智能调度 DNS 发起域名解析请求
1. 智能调度 DNS 会根据客户端的地理位置、接入网类型（电信还是网通）等参数，将请求交给位置最近的、离用户路由最短的、负载最轻的 Cache 节点，实现就近定位
1. 最终 LDNS 从智能调度 DNS 那获取到目标 IP 地址，并发起请求



### 总结

简单来说，CDN 只是在原有的基础上加了一层 **Cache** 层，用户端的请求会交由智能调度 DNS 来进行解析，然后选择最优节点的 IP 返回。这样做不仅能够优化用户访问资源的速度，还可以节省源服务器的资源，降低它的负载

这里用物流来举一个例子：

假如我们要在网上购买一个商品，而发货都是需要从仓库里发出来的，如果商家的仓库离我们很远，那么就会花费很多时间在商品的运输上；但若是商家在全国各地建立了好几个小的仓库，然后由总部发配商品到各个小仓库，这样用户每次购买商品时，就可以匹配离用户最近的仓库发货，这样就可以减少物流所需的时间了。CDN 其实做的也是这么一回事

